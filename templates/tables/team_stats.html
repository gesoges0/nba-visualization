<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NBA Visualization</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link href="{{ url_for('static', path='/styles.css') }}" rel="stylesheet">
    <script src="https://d3js.org/d3.v6.js"></script>

<script>
function barchart(data, stats_key, colors) {
    // set the dimensions and margins of the graph
    const margin = {top: 20, right: 30, bottom: 40, left: 90},
        width = 500 - margin.left - margin.right,
        height = 200 - margin.top - margin.bottom;

    // append the svg object to the body of the page
    const svg = d3.select("#stats_" + stats_key)
      .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
      .append("g")
        .attr("transform", `translate(${margin.left}, ${margin.top})`);

  // Add X axis
  const x = d3.scaleLinear()
    .domain([0, d3.max(data, d => d.stats)])
    .range([ 0, width]);
  svg.append("g")
    .attr("transform", `translate(0, ${height})`)
    .call(d3.axisBottom(x))
    .selectAll("text")
      .attr("transform", "translate(-10,0)rotate(-45)")
      .style("text-anchor", "end");

  // Y axis
  const y = d3.scaleBand()
    .range([ 0, height ])
    .domain(data.map(d => d.TEAM))
    .padding(.1);
  svg.append("g")
    .call(d3.axisLeft(y))

  //Bars
  svg.selectAll("myRect")
    .data(data)
    .join("rect")
    .attr("x", x(0) )
    .attr("y", d => y(d.TEAM))
    .attr("width", d => x(d.stats))
    .attr("height", y.bandwidth())
    .attr("fill", d => colors[d.TEAM])

  // title
  svg.append("text")
    .attr("x", x(d3.max(data, d => d.stats)/2))
    .attr("y", y(0))
    .attr("font-size", "13px")
    .attr("text-anchor", "top")
    .attr("font-weight", 700)
    .text(stats_key)
}
</script>
</head>
<body>
    <div class="alert alert-success" role="alert">
        {{debug}}
    </div>

    <div class="row">
        <!--GAME_IDにおける試合結果-->
        <div class="col-12">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        {% for stats in AWAY.keys() %}
                            {% if stats not in ['GAME_ID', 'TEAM_ID', 'TEAM_NAME', 'TEAM_ABBREVIATION', 'TEAM_CITY'] %}
                            <th scope="col">{{stats}}</th>
                            {% endif %}
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th scope="row">{{AWAY.TEAM_ABBREVIATION}}</th>
                        {% for key, stats in AWAY.items() %}
                            {% if key not in ['GAME_ID', 'TEAM_ID', 'TEAM_NAME', 'TEAM_ABBREVIATION', 'TEAM_CITY'] %}
                            <td scope="col">{{stats}}</td>
                            {% endif %}
                        {% endfor %}
                    </tr>
                    <tr>
                        <th scope="row">{{HOME.TEAM_ABBREVIATION}}</th>
                        {% for key, stats in HOME.items() %}
                            {% if key not in ['GAME_ID', 'TEAM_ID', 'TEAM_NAME', 'TEAM_ABBREVIATION', 'TEAM_CITY'] %}
                            <td scope="col">{{stats}}</td>
                            {% endif %}
                        {% endfor %}
                    </tr>
                </tbody>
            </table>
        </div>
        <!--グラフ-->
        {% for key in AWAY.keys() %}
            {% if (loop.index -1) % 3 == 0 %}
                <div class="row">
            {% endif %}
            {% if key not in ['GAME_ID', 'TEAM_ID', 'TEAM_NAME', 'TEAM_ABBREVIATION', 'TEAM_CITY', 'MIN'] %}
                <div class="col-4">
                    <div id="stats_{{key}}"></div>
                    <script>
                        var data = [{"TEAM": "{{AWAY.TEAM_ABBREVIATION}}", "stats": {{AWAY[key]}}}, {"TEAM": "{{HOME.TEAM_ABBREVIATION}}", "stats": {{HOME[key]}}}]
                        var colors = {"{{AWAY.TEAM_ABBREVIATION}}": "#00471B", "{{HOME.TEAM_ABBREVIATION}}": "#007A33"}
                        barchart(data, "{{key}}", colors);
                    </script>
                </div>
            {% endif %}
            {% if (loop.index-1) % 3 == 2 %}
                </div>
            {% endif %}
        {% endfor %}
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</body>
</html>

